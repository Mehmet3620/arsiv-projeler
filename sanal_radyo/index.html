<!DOCTYPE html>
<html>
<head>
    <title>Ã–zgÃ¼n Radyo Player</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #player-container {
            width: 80%;
            max-width: 600px;
            background-color: rgba(34, 34, 34, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            z-index: 10;
        }

        #visualizer-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 11;
        }

        .fullscreen-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 15;
            padding: 5px;
        }

        #content-wrapper {
            position: relative;
            z-index: 12;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .vinyl-container {
            position: relative;
            width: 110px;
            height: 110px;
            margin-bottom: 20px;
        }

        .vinyl-record {
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%),
                linear-gradient(-45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%),
                radial-gradient(circle, #555, #111 60%);
            background-size: 5px 5px, 5px 5px, cover;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            animation: rotate 10s linear infinite paused;
            position: relative;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .vinyl-record::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            background-color: #111;
            border: 2px solid black;
            border-radius: 50%;
        }

        #circular-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 60%;
            height: 60%;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        #circular-text span {
            position: absolute;
            top: 19%;
            left: 80%;
            color: #ccc;
        }

        #radio-info {
            text-align: center;
            margin-bottom: 20px;
        }

        #radio-name {
            font-size: 24px;
            font-weight: bold;
            color: #ff5722;
        }

        #song-title {
            font-size: 18px;
            color: #ccc;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        #play-pause-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #ff5722;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #play-pause-btn:hover {
            background-color: #e64a19;
        }

        .volume-control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #volume-icon {
            font-size: 24px;
            color: #ccc;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 150px;
            height: 8px;
            background: #444;
            outline: none;
            border-radius: 4px;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ff5722;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
        }

        .social-buttons {
            margin-top: 20px;
            display: flex;
            gap: 20px;
        }

        .social-buttons a {
            color: #fff;
            font-size: 24px;
            text-decoration: none;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .social-buttons a:hover {
            opacity: 1;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>

    <div id="player-container">
        <canvas id="visualizer-canvas"></canvas>
        <button class="fullscreen-btn" id="fullscreen-btn">&#x26F6;</button>

        <div id="content-wrapper">
            <div class="vinyl-container">
                <div class="vinyl-record">
                    <div id="circular-text"></div>
                </div>
            </div>

            <div id="radio-info">
                <div id="radio-name">Allaturkaa Radyo</div>
                <div id="song-title">Ã‡alan ÅžarkÄ±: YÃ¼kleniyor...</div>
            </div>

            <div id="controls">
                <button id="play-pause-btn">&#9658;</button>
                <div class="volume-control-group">
                    <span id="volume-icon">&#x1F50A;</span>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">
                </div>
            </div>

            <div class="social-buttons">
                <a href="https://www.facebook.com/radyoallaturka" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.twitter.com/radyoallaturka" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="https://www.instagram.com/radyoallaturka" target="_blank"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        const playPauseBtn = document.getElementById('play-pause-btn');
        const volumeSlider = document.getElementById('volume-slider');
        const visualizerCanvas = document.getElementById('visualizer-canvas');
        const playerContainer = document.getElementById('player-container');
        const volumeIcon = document.getElementById('volume-icon');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const vinylRecord = document.querySelector('.vinyl-record');
        const circularText = document.getElementById('circular-text');
        const songTitle = document.getElementById('song-title');

        const radioStreamUrl = 'https://eu4.fastcast4u.com/proxy/allaturka?mp=/1';
        const audio = new Audio();
        let audioContext, analyser, source, dataArray;
        let isPlaying = false;
        
        function getSongTitle() {
            fetch('https://allaturka.live/yayin.php')
                .then(response => response.json())
                .then(data => {
                    if (data && data.current_song) {
                        songTitle.textContent = `Ã‡alan ÅžarkÄ±: ${data.current_song}`;
                    } else {
                        songTitle.textContent = 'Ã‡alan ÅžarkÄ±: Bilgi Yok';
                    }
                })
                .catch(error => {
                    console.error('ÅžarkÄ± bilgisi alÄ±namadÄ±:', error);
                    songTitle.textContent = 'Ã‡alan ÅžarkÄ±: Bilgi Yok';
                });
        }
        
        getSongTitle();
        setInterval(getSongTitle, 10000);

        function setupAudio() {
            if (audioContext) return;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 512;
            dataArray = new Uint8Array(analyser.fftSize);
            source = audioContext.createMediaElementSource(audio);
            source.connect(analyser);
            analyser.connect(audioContext.destination);

            volumeSlider.addEventListener('input', () => {
                audio.volume = volumeSlider.value;
                updateVolumeIcon(audio.volume);
            });
            audio.volume = volumeSlider.value;
            updateVolumeIcon(audio.volume);
        }

        function updateVolumeIcon(volume) {
            if (volume == 0) {
                volumeIcon.textContent = 'ðŸ”‡';
            } else if (volume < 0.5) {
                volumeIcon.textContent = 'ðŸ”‰';
            } else {
                volumeIcon.textContent = 'ðŸ”Š';
            }
        }

        function createCircularText(text, elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            const characters = text.split('');
            const degreeStep = 360 / characters.length;
            let currentDegree = -90;
            const radius = (vinylRecord.offsetWidth / 2) - 15;

            characters.forEach(char => {
                const span = document.createElement('span');
                span.textContent = char;
                span.style.transformOrigin = `0 ${radius}px`;
                span.style.transform = `rotate(${currentDegree}deg) translate(0px, -${radius}px) rotate(90deg)`;
                element.appendChild(span);
                currentDegree += degreeStep;
            });
        }
        createCircularText('RADYO ALLATURKA', 'circular-text');

        playPauseBtn.addEventListener('click', () => {
            if (!isPlaying) {
                setupAudio();
                audio.src = radioStreamUrl;
                audio.crossOrigin = "anonymous";
                audio.play().then(() => {
                    isPlaying = true;
                    playPauseBtn.innerHTML = '&#10074;&#10074;';
                    vinylRecord.style.animationPlayState = 'running';
                }).catch(e => {
                    console.error("Oynatma hatasÄ±:", e);
                    alert("Radyo akÄ±ÅŸÄ± baÅŸlatÄ±lamadÄ±. CORS veya adres sorunu olabilir.");
                });
            } else {
                audio.pause();
                isPlaying = false;
                playPauseBtn.innerHTML = '&#9658;';
                vinylRecord.style.animationPlayState = 'paused';
            }
        });

        fullscreenBtn.addEventListener('click', () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
                fullscreenBtn.innerHTML = '&#x26F6;';
            } else {
                playerContainer.requestFullscreen();
                fullscreenBtn.innerHTML = '&#x26F5;';
            }
        });

        // 3D PARÃ‡ACIK GÃ–RSELLEÅžTÄ°RME KODU
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, playerContainer.offsetWidth / playerContainer.offsetHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: visualizerCanvas, antialias: true, alpha: true });
        renderer.setSize(playerContainer.offsetWidth, playerContainer.offsetHeight);

        camera.position.z = 200;

        const particleCount = 2000;
        const particlesGeometry = new THREE.BufferGeometry();
        const positions = new Float32Array(particleCount * 3);
        const colors = new Float32Array(particleCount * 3);
        const velocities = new Float32Array(particleCount * 3);

        const color = new THREE.Color();
        const baseHue = 0.08;

        for (let i = 0; i < particleCount; i++) {
            const i3 = i * 3;
            positions[i3 + 0] = (Math.random() - 0.5) * 500;
            positions[i3 + 1] = (Math.random() - 0.5) * 500;
            positions[i3 + 2] = (Math.random() - 0.5) * 500;

            velocities[i3 + 0] = (Math.random() - 0.5) * 0.1;
            velocities[i3 + 1] = (Math.random() - 0.5) * 0.1;
            velocities[i3 + 2] = (Math.random() - 0.5) * 0.1;

            color.setHSL(baseHue, 1, 0.5);
            colors[i3 + 0] = color.r;
            colors[i3 + 1] = color.g;
            colors[i3 + 2] = color.b;
        }

        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        particlesGeometry.velocities = velocities;

        const particlesMaterial = new THREE.PointsMaterial({
            size: 2,
            vertexColors: true,
            blending: THREE.AdditiveBlending,
            transparent: true,
            opacity: 0.8
        });

        const particles = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particles);

        function animate() {
            requestAnimationFrame(animate);

            if (isPlaying && analyser) {
                analyser.getByteFrequencyData(dataArray);

                const positions = particles.geometry.attributes.position.array;
                const colors = particles.geometry.attributes.color.array;
                const velocities = particles.geometry.velocities;

                const averageFrequency = dataArray.reduce((a, b) => a + b) / dataArray.length;
                const scale = averageFrequency / 1000;
                
                const lowFrequency = dataArray.slice(0, 100).reduce((a, b) => a + b) / 100;
                const highFrequency = dataArray.slice(100, 256).reduce((a, b) => a + b) / 156;

                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;

                    positions[i3 + 0] += velocities[i3 + 0] * (1 + scale * 5);
                    positions[i3 + 1] += velocities[i3 + 1] * (1 + scale * 5);
                    positions[i3 + 2] += velocities[i3 + 2] * (1 + scale * 5);

                    if (Math.abs(positions[i3 + 0]) > 250 || Math.abs(positions[i3 + 1]) > 250 || Math.abs(positions[i3 + 2]) > 250) {
                        positions[i3 + 0] = (Math.random() - 0.5) * 500;
                        positions[i3 + 1] = (Math.random() - 0.5) * 500;
                        positions[i3 + 2] = (Math.random() - 0.5) * 500;
                    }
                    
                    const hue = (baseHue + highFrequency / 255) % 1;
                    const saturation = 1;
                    const lightness = 0.5 + lowFrequency / 500;
                    color.setHSL(hue, saturation, lightness);
                    colors[i3 + 0] = color.r;
                    colors[i3 + 1] = color.g;
                    colors[i3 + 2] = color.b;
                }

                particles.geometry.attributes.position.needsUpdate = true;
                particles.geometry.attributes.color.needsUpdate = true;
            }

            camera.rotation.z += 0.0005;
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = playerContainer.offsetWidth / playerContainer.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(playerContainer.offsetWidth, playerContainer.offsetHeight);
            createCircularText('RADYO ALLATURKAA', 'circular-text');
        });
        window.dispatchEvent(new Event('resize'));
    </script>
</body>
</html>