<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radyo Allaturkaa - Kesintisiz Ekolayzır</title>
    <style>
    #radio-container-main {
        width: 700px; height: 80px; display: flex; align-items: center; 
        background: #0d47a1; color: #fff; font-family: 'Segoe UI', sans-serif; 
        border-radius: 6px; overflow: hidden; position: relative;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .side-box {
        width: 85px; height: 100%; background: rgba(0,0,0,0.45); 
        display: flex; align-items: center; justify-content: center; 
        cursor: pointer; z-index: 10; flex-shrink: 0;
    }

    #volume-master-area {
        flex: 1; height: 100%; position: relative; 
        background: rgba(0,0,0,0.85); 
        cursor: pointer; overflow: hidden; min-width: 0;
    }
    
    #volume-fill-layer {
        height: 100%; width: 50%; 
        background: rgba(255,255,255,0.2); 
        pointer-events: none;
    }

    .visualizer-canvas {
        position: absolute; bottom: 0; left: 0; 
        width: 100%; height: 55px; opacity: 0.5; 
        pointer-events: none;
    }

    #info-layer {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; flex-direction: column; justify-content: center;
        padding-left: 10px; 
        pointer-events: none; z-index: 5;
    }

    .right-panel-fixed {
        width: 200px; height: 100%; background: rgba(0,0,0,0.45); 
        display: flex; align-items: center; justify-content: flex-end; 
        padding-right: 15px; gap: 8px; z-index: 10; flex-shrink: 0;
    }

    .color-select {
        background: #fff; color: #333; border: none; border-radius: 3px; 
        padding: 4px 6px; font-size: 11px; font-weight: bold; cursor: pointer;
    }

    .vol-text-area {
        display: flex; flex-direction: column; align-items: center; 
        justify-content: center; gap: 2px; min-width: 45px;
    }

    #vol-num { font-size: 15px; font-weight: bold; }
    .cc_streaminfo { color: #fff; text-decoration: none; font-size: 13px; font-weight: 500; }
</style>
</head>
<body>

<div id="radio-container-main">
    <div id="btn-square" class="side-box" onclick="toggleRadio()">
        <svg id="p-icon" width="40" height="40" fill="white" viewBox="0 0 16 16">
            <path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
        </svg>
    </div>

    <div id="volume-master-area">
        <canvas id="visualizer" class="visualizer-canvas"></canvas>
        <div id="volume-fill-layer"></div>
        <div id="info-layer">
            <div style="font-size: 18px; font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.6);">Radyo Allaturkaa</div>
            <div style="width: 380px; overflow: hidden;">
                <marquee behavior="scroll" direction="left" scrollamount="3">
                    <a class="cc_streaminfo" data-type="song" data-username="allaturka">Yükleniyor...</a>
                </marquee>
            </div>
        </div>
    </div>

    <div class="right-panel-fixed">
        <select class="color-select" onchange="updateTheme(this.value)">
            <option value="#0d47a1">Okyanus Mavisi</option>
            <option value="#4a148c">Mat Mor</option>
            <option value="#2c3e50">Gece Mavisi</option>
            <option value="#1b5e20">Orman Yeşili</option>
            <option value="#b71c1c">Koyu Kırmızı</option>
            <option value="#455a64">Koyu Füme</option>
            <option value="#e65100">Yanık Turuncu</option>
            <option value="#212121">Siyah Mat</option>
            <option value="#006064">Koyu Turkuaz</option>
            <option value="#3e2723">Kahve Tonu</option>
            <option value="#880e4f">Vişne Çürüğü</option>
            <option value="#283593">İndigo Mavi</option>
            <option value="#5d4037">Toprak Rengi</option>
            <option value="#004d40">Petrol Yeşili</option>
            <option value="#6a1b9a">Parlak Eflatun</option>
            <option value="#2e7d32">Çimen Yeşili</option>
            <option value="#c62828">Nar Çiçeği</option>
            <option value="#37474f">Mavi Gri</option>
            <option value="#558b2f">Zeytin Dalı</option>
            <option value="#bf360c">Kiremit Rengi</option>
        </select>
        <div class="vol-text-area">
            <svg width="28" height="28" fill="white" viewBox="0 0 16 16">
                <path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/><path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"/><path d="M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/>
            </svg>
            <span id="vol-num">50%</span>
        </div>
    </div>
    <audio id="allaturka-audio" src="https://eu4.fastcast4u.com/proxy/allaturka?mp=/1" crossorigin="anonymous"></audio>
</div>

<script src="https://eu4.fastcast4u.com/system/streaminfo.js"></script>
<script>
    const audio = document.getElementById('allaturka-audio');
    const volFill = document.getElementById('volume-fill-layer');
    const volNum = document.getElementById('vol-num');
    const pIcon = document.getElementById('p-icon');
    const volArea = document.getElementById('volume-master-area');
    const mainContainer = document.getElementById('radio-container-main');
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');

    const playSVG = '<path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>';
    const pauseSVG = '<path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/>';

    let isDragging = false;
    let audioCtx, analyser, dataArray;

    function updateTheme(color) { if(mainContainer) mainContainer.style.background = color; }

    function setVolume(e) {
        const rect = volArea.getBoundingClientRect();
        let x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
        let percent = Math.round((x / rect.width) * 100);
        audio.volume = percent / 100;
        volFill.style.width = percent + '%';
        volNum.innerText = percent + '%';
    }

    volArea.addEventListener('mousedown', (e) => { isDragging = true; setVolume(e); });
    window.addEventListener('mousemove', (e) => { if (isDragging) setVolume(e); });
    window.addEventListener('mouseup', () => { isDragging = false; });

    function initVisualizer() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            const source = audioCtx.createMediaElementSource(audio);
            source.connect(analyser);
            analyser.connect(audioCtx.destination);
            analyser.fftSize = 256;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
        }
        draw();
    }

    function draw() {
        if (audio.paused) { ctx.clearRect(0, 0, canvas.width, canvas.height); return; }
        requestAnimationFrame(draw);
        analyser.getByteFrequencyData(dataArray);
        
        canvas.width = volArea.clientWidth; 
        canvas.height = 55;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const barWidth = 2;
        const totalBars = dataArray.length / 1.4; 
        const spacing = (canvas.width / totalBars); 
        
        for (let i = 0; i < totalBars; i++) {
            // SAĞI DOLDUR VE ÜSTTEN KESMEYİ ÖNLE
            const boost = 1 + (i / totalBars) * 1.6; 
            // 0.6 çarpanı ile tepe noktasını biraz aşağı çektik (kesilmesin diye)
            const barHeight = (dataArray[i] / 255) * canvas.height * 0.6 * boost;
            
            ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
            // Max tavan payı (canvas.height * 0.82) keskin kesilmeyi önleyen yumuşak sınırdır
            const finalH = Math.min(barHeight, canvas.height * 0.82);
            ctx.fillRect(i * spacing, canvas.height - finalH, barWidth, finalH);
        }
    }

    function toggleRadio() {
        if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
        if (audio.paused) { audio.play(); pIcon.innerHTML = pauseSVG; initVisualizer(); }
        else { audio.pause(); pIcon.innerHTML = playSVG; }
    }
</script>
</body>
</html>